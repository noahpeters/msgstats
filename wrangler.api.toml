name = "msgstats-api"
compatibility_date = "2026-01-01"
compatibility_flags = ["nodejs_compat"]
main = "workers/api/worker.ts"

[vars]
META_REDIRECT_URI = "https://msgstats.from-trees.com/api/auth/callback"
META_SCOPES = "pages_show_list,pages_messaging,pages_read_engagement,pages_manage_metadata,business_management,instagram_basic,instagram_manage_messages"

[[d1_databases]]
binding = "DB"
database_name = "msgstats-db"
database_id = "b1918df0-760c-41f1-9778-9d5f95ab9a41"

[[durable_objects.bindings]]
name = "SYNC_RUNS_HUB"
class_name = "SyncRunsHub"
script_name = "msgstats-web"

[[durable_objects.bindings]]
name = "SYNC_SCOPE_ORCHESTRATOR"
class_name = "SyncScopeOrchestrator"

[[migrations]]
tag = "v1"
new_classes = ["SyncScopeOrchestrator"]

[queues]

[[queues.producers]]
binding = "SYNC_QUEUE"
queue = "msgstats-sync"

[[queues.consumers]]
queue = "msgstats-sync"
max_batch_size = 1
[observability]
[observability.logs]
enabled = true
invocation_logs = true

[triggers]
crons = ["0 * * * *"]
