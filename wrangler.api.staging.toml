name = "msgstats-api-staging"
compatibility_date = "2026-01-01"
compatibility_flags = ["nodejs_compat"]
main = "workers/api/worker.ts"

[vars]
META_REDIRECT_URI = "https://staging.msgstats.from-trees.com/api/auth/callback"
META_SCOPES = "pages_show_list,pages_messaging,pages_read_engagement,pages_manage_metadata,business_management,instagram_basic,instagram_manage_messages"

[[d1_databases]]
binding = "DB"
database_name = "msgstats-db-staging"
database_id = "54853690-cef8-4a81-9908-0dcdb9ad5910"

[[durable_objects.bindings]]
name = "SYNC_RUNS_HUB"
class_name = "SyncRunsHub"
script_name = "msgstats-web-staging"

[[durable_objects.bindings]]
name = "SYNC_SCOPE_ORCHESTRATOR"
class_name = "SyncScopeOrchestrator"

[[migrations]]
tag = "v1"
new_classes = ["SyncScopeOrchestrator"]

[[analytics_engine_datasets]]
binding = "AE_META_CALLS"
dataset = "AE_META_CALLS"

[[analytics_engine_datasets]]
binding = "AE_APP_ERRORS"
dataset = "AE_APP_ERRORS"

[queues]

[[queues.producers]]
binding = "SYNC_QUEUE"
queue = "msgstats-sync-staging"

[[queues.consumers]]
queue = "msgstats-sync-staging"
max_batch_size = 1

[observability]
[observability.logs]
enabled = true
invocation_logs = true

[triggers]
crons = ["*/5 * * * *"]
